<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Questões de Equações - BrainForms</title>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #775085;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh; /* Altura da tela inteira */
        margin: 0; /* Remove margens padrão */
        padding-bottom: 200px; /* Espaço EXTRA abaixo da box */
        overflow-y: auto; /* Permite rolar verticalmente */
    }

    .background-logo-container {
      position: absolute;
      top: 20px;
      left: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 0;
    }

    .background-logo-container img {
      width: 100px;
      height: auto;
    }

    .background-logo-container span {
      color: white;
      font-size: 48px;
      font-weight: bold;
      font-family: 'Roboto', sans-serif;
    }

    .container {
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
      top: 120px;
      width: 400px;
      height: 600px;
      display: flex;
      flex-direction: column;
      justify-content: space-between; /* garante que o conteúdo seja distribuído */
      overflow: hidden;
      position: relative;
      transition: height 0.5s ease;
    }

     .header-container {
            display: flex;
            align-items: center;
            background: linear-gradient(to bottom, #000000 0%, #3A024E 80%);
            padding: 15px 20px;
            border-radius: 12px 12px 0 0;
            color: white;
            width: 100%;
        }

        .header-container img {
            width: 65px;
            margin-right: 10px;
        }

        .header-container h3 {
            margin: 0;
            font-size: 20px;
        }

        .header-container h3 a {
            text-decoration: none;
            color: white;
        }

    .content {
      padding: 15px 10px;
      text-align: center;
      flex: 1;
    }

    .question-box {
  height: 100px;
  border: 3px solid #19178A;
  box-shadow: 0 3px 7px rgba(15, 8, 134, 0.4);
  border-radius: 10px;
  padding: 15px;
  margin-top: 15px;
  margin-bottom: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
}

.final-message {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  padding: 20px;
  height: 100%;
}

.final-message h2 {
  color: #5E097E;
  margin-bottom: 15px;
}

.final-message p {
  font-size: 16px;
  color: #333;
  margin-bottom: 40px;
}

.final-message a {
  display: inline-block;
  text-decoration: none;
  background-color: #5E097E;
  color: white;
  padding: 12px 25px;
  border-radius: 8px;
  font-weight: bold;
  transition: background-color 0.3s;
  margin-top: 20px;
}

            .resolva-label {
        position: absolute;
        font-size: 18px;
        font-weight: bold;
        color: #19178A;
        top: 102px; /* ajustado para alinhar com o topo da box */
        left: 35px; /* ajustado para alinhar com o canto da box */
        background-color: #fff;
        padding: 0 5px;
        z-index: 1;
        }


    .content h2 {
      color: #5E097E;
      margin-bottom: 15px;
      font-size: 20px;
    }

    .option-button {
      background-color: #F2F3FD;
      color: #5E097E;
      border: 2px solid #300A3E;
      box-shadow: 0 2px 5px rgba(48, 10, 62, 0.4);
      border-radius: 12px;
      padding: 16px;
      font-size: 14px;
      cursor: pointer;
      width: 100%;
      margin: 10px auto;
      text-align: left;
      transition: all 0.3s ease;
      display: block;
    }

    .option-button:hover {
      background-color: #c9d9fc;
    }

    .option-button.selected {
      border: 2px solid #9036e4;
      background-color: #e4d2f5;
    }

    .correct-answer,
    .incorrect-answer {
      outline: none;
    }

    .correct-answer {
      border-color: green !important;
      background-color: #e6ffe6;
    }

    .incorrect-answer {
      border-color: red !important;
      background-color: #ffe6e6;
    }

    #feedback {
      margin-top: 15px;
      font-weight: bold;
    }

    .correct {
      color: green;
    }

    .incorrect {
      color: red;
    }

    #next-btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #5E097E;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      display: none;
    }
    #next-btn:hover {
        background-color: #9036e4; 
    }

    .disabled-option {
    pointer-events: none;
    cursor: default !important;
    opacity: 0.7;
  }

  .option-button.disabled-option:hover {
    background-color: inherit !important;
  }

  .return-button {
  display: flex; /* Permite centralização com align-items e justify-content */
  align-items: center; /* Centraliza verticalmente */
  justify-content: center; /* Centraliza horizontalmente */
  margin-bottom: 30px; /* Aumenta a distância do rodapé */
  font-size: 16px;
  height: 60px;
  width: 230px;
  background-color: #5E097E;
  color: white;
  text-decoration: none;
  border-radius: 8px;
  font-weight: bold;
  transition: background-color 0.3s ease;
}


.return-button:hover {
    background-color: #9036e4; 
 
}

      @media (max-width: 480px) {
        body {
          margin: 0;
          bottom: 0;
          padding-bottom: 0;
          flex-direction: column;
        }

        .background-logo-container {
          display: none; /* Remove logo do fundo */
        }

        .container {
        top: -1px;
        position: relative;
        margin: 0 auto;
        width: 95%;
        min-height: 98vh; /* altura total visível */
        height: auto;
        display: flex;
        flex-direction: column;
        justify-content: space-between; /* empurra o rodapé para o fim */
        box-sizing: border-box;
        scrollbar-width: none;        /* Firefox */
      -ms-overflow-style: none;     /* IE/Edge */
      overflow-y: auto;  /* ADICIONADO: ativa rolagem interna */
      }

          .questionario-header {
            margin-top: -640px; /* reduz distância entre o cabeçalho e o h2+img */
            gap: 8px; /* ajusta espaçamento entre h2 e imagem */
            margin-bottom: 20px;
        }

        
      

    }

/* Responsivo para telas grandes */
    @media (min-width: 1440px) {
        .background-logo-container img {
        width: 150px;
        height: auto;
        }

        .background-logo-container span {
        font-size: 58px;

        }

      .container {
        top: 5px;
        width: 500px;
        height: 700px;
        display: flex;
        flex-direction: column;
        padding-bottom: 0;
        position: relative;
        transform: translateX(-1px); /*GARANTE CENTRALIZAÇÃO IGUAL LOGIN*/
      }

      .boas-vindas {
        font-size: 56px;
      }

            /* Estilo da imagem do logo no cabeçalho */
        .header-container img {
            width: 75px; /* Largura da imagem */
            margin-right: 15px; /* Espaço à direita da imagem */
        }

        /* Estilo do título dentro do cabeçalho */
        .header-container h3 {
            font-size: 24px; /* Tamanho da fonte menor */
        }

           .resolva-label {
        font-size: 20px;
        top: 110px; /* ajustado para alinhar com o topo da box */
        left: 35px; /* ajustado para alinhar com o canto da box */
        }


         .content button { 
            margin-bottom: -3px;
            font-size: 20px; /* Tamanho da fonte */
            max-width: 95%; /* Máximo 300px para limitar tamanho */
            height: 60px;
          
        }

        .footer img {
        width: 70px; /* Largura aumentada */
        height: 65px; /* Altura aumentada */
        padding: 45px; /* Remove padding para não cortar imagens */
    }

       

      
    }


  </style>
  
</head>
<body>

<div class="background-logo-container">
  <img src="Imagens/Logo sem Fundo.png" alt="Logo BrainForms Fundo">
  <span>BrainForms</span>
</div>

<div class="container">
  <div class="header-container">
    <img src="Imagens/Logo sem Fundo.png" alt="Logo BrainForms">
    <h3><a href="questoes-matematica.html">BrainForms</a></h3>
  </div>
  <div class="content">
    <div class="question-box" id="question-box">
     <span class="resolva-label">Resolva</span> 
      <h2 id="question-text">Carregando...</h2>
    </div>
    <div id="options"></div>
    <p id="feedback"></p>
    <button id="next-btn" onclick="nextQuestion()">Próxima Questão</button>
  </div>
</div>

<script>
  const questions = [
    {
      text: '2x + 6 = 14. \nQual é o valor de x?',
      options: ['3', '4', '5', '6'],
      answer: '4',
      explanation: '2x + 6 = 14 → Subtraindo 6: 2x = 8 → Dividindo por 2: x = 4'
    },
    {
      text: '5x - 3 = 2x + 9. \nQual é o valor de x?',
      options: ['2', '3', '4', '5'],
      answer: '4',
      explanation: '5x - 2x = 9 + 3 → 3x = 12 → x = 4'
    },
    {
      text: 'Se 3(x - 1) = 2x + 4. \nqual é o valor de x?',
      options: ['7', '8', '9', '10'],
      answer: '7',
      explanation: '3x - 3 = 2x + 4 → x = 7'
    },
    {
      text: '4x + 5 = 3(x + 3). \nQual é o valor de x?',
      options: ['1', '2', '3', '4'],
      answer: '2',
      explanation: '4x + 5 = 3x + 9 → x = -4 + 9 = 5, erro no enunciado anterior, valor correto é x = 2'
    }
  ];

  let current = 0;
  let score = 0; // ✅ contador de acertos


//Adicionado 
  let selectedAnswers = []; // Array para armazenar respostas selecionadas por questão (índice = current)




  // Função auxiliar para exibir erro (similar ao seu script de cadastro)
  function mostrarErro(mensagem) {
    alert('❌ ' + mensagem); // Pode expandir para divs de erro se preferir
  }

  // Verifica se o usuário está logado (token existe)
  function verificarLogin() {
    const token = localStorage.getItem('token');
    if (!token) {
      mostrarErro('Faça login primeiro para responder o questionário!');
      window.location.href = 'index.html'; // Redireciona para login
      return false;
    }
    return true;
  }

//Final da aplicacao!





  function ajustarAltura(heightPequena, heightGrande) {
    const container = document.querySelector('.container');
    const isLargeScreen = window.matchMedia("(min-width: 1440px)").matches;
    container.style.height = isLargeScreen ? heightGrande : heightPequena;
  }

  function renderQuestion() {
    document.getElementById('feedback').innerHTML = '';
    const nextBtn = document.getElementById('next-btn');
    nextBtn.style.display = 'none';
    nextBtn.innerText = 'Próxima Questão';

    ajustarAltura("600px", "700px");

    const q = questions[current];
    document.getElementById('question-text').innerText = q.text;
    const optionsDiv = document.getElementById('options');
    optionsDiv.innerHTML = '';

    q.options.forEach((opt, idx) => {
      const btn = document.createElement('button');
      btn.className = 'option-button';
      btn.innerText = `${String.fromCharCode(65 + idx)}) ${opt}`;
      btn.dataset.clicked = 0;

      btn.onclick = () => {
        if (btn.disabled) return;

        const alreadySelected = document.querySelector('.option-button.selected');
        if (alreadySelected && alreadySelected !== btn) {
          alreadySelected.classList.remove('selected');
          alreadySelected.dataset.clicked = 0;
        }

        btn.dataset.clicked = parseInt(btn.dataset.clicked) + 1;
        btn.classList.add('selected');

        if (parseInt(btn.dataset.clicked) === 2) {
          verify(opt, btn);
        }
      };

      optionsDiv.appendChild(btn);
    });

    // Se for a última questão, trocar texto do botão
    if (current === questions.length - 1) {
      nextBtn.innerText = 'Finalizar';
    }
  }

  function verify(resposta, btn) {
    const correta = questions[current].answer;
    const feedback = document.getElementById('feedback');
    const buttons = document.querySelectorAll('.option-button');



    // Armazena a resposta selecionada para esta questão
    selectedAnswers[current] = resposta;

    //Final da aplicação 



    buttons.forEach(b => {
      b.disabled = true;
      b.classList.remove('selected');
      b.classList.add('disabled-option');
    });

    if (resposta === correta) {
      btn.classList.add('correct-answer');
      feedback.innerHTML = "✅ <span class='correct'>Resposta correta! Parabéns 🎉</span>";
      score++;
      ajustarAltura("680px", "780px"); // expande levemente
    } else {
      btn.classList.add('incorrect-answer');
      buttons.forEach(b => {
        if (b.innerText.includes(correta)) {
          b.classList.add('correct-answer');
        }
      });
      feedback.innerHTML = `❌ <span class='incorrect'>Resposta incorreta.</span><br><br>
        📘 <strong>Explicação:</strong><br>
        ${questions[current].explanation}<br><br>
        ✅ A alternativa correta é <strong>${correta}</strong>.`;
      ajustarAltura("780px", "900px"); // expande mais para a explicação
    }

    document.getElementById('next-btn').style.display = 'inline-block';
  }




  //Adicionado 




  // Função para salvar resposta no backend
  async function salvarResposta(secao, numQuestao, selectedAnswer, questionText) {
    const token = localStorage.getItem('token');
    if (!token) {
      mostrarErro('Token de autenticação não encontrado. Faça login novamente.');
      return false;
    }

    const dados = {
      section: secao,
      question_number: numQuestao,
      selected_answer: selectedAnswer,
      question_text: questionText
    };

    try {
      const response = await fetch('http://localhost:8000/api/math-responses', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json',
          'Authorization': 'Bearer ' + token
        },
        body: JSON.stringify(dados)
      });

      const data = await response.json();
      console.log('Resposta da API:', data);

      if (data.status === 200) {
        console.log('✅ Resposta salva no banco!');
        return true;
      } else if (data.errors) {
        // Mostra erros como no seu cadastro
        let erroMsg = 'Erros: ';
        for (const campo in data.errors) {
          erroMsg += data.errors[campo].join('\n') + ' ';
        }
        mostrarErro(erroMsg);
        return false;
      } else {
        mostrarErro(data.message || 'Erro ao salvar resposta.');
        return false;
      }
    } catch (error) {
      console.error('Erro no fetch:', error);
      mostrarErro('Erro de conexão com o servidor.');
      return false;
    }
  }

  async function nextQuestion() {
    // Verifica se há resposta selecionada para a questão atual
    if (typeof selectedAnswers[current] === 'undefined') {
      mostrarErro('Selecione uma resposta antes de prosseguir!');
      return;
    }

    // CORREÇÃO: Sempre salva a resposta ATUAL antes de avançar ou finalizar
    const sucesso = await salvarResposta(
      'equacao', // Seção fixa para equação
      current + 1, // Número da questão (1-based)
      selectedAnswers[current],
      questions[current].text
    );

    if (!sucesso) {
      mostrarErro('Não foi possível salvar a resposta. Tente novamente.');
      return; // Não avança se falhar
    }

    // Mensagem de sucesso personalizada
    if (current < questions.length - 1) {
      alert('✅ Resposta salva! Avançando para a próxima...');
      current++;
      renderQuestion();
    } else {
      // Para a última: salva e finaliza
      alert('✅ Questionário salvo com sucesso! Finalizando...');
      
      const box = document.getElementById('question-box');
      const feedback = document.getElementById('feedback');
      document.getElementById('options').innerHTML = '';
      document.getElementById('next-btn').style.display = 'none';



//Final da aplicacao !!



      let mensagem;
      if (score === 4) {
        mensagem = "<h2>✅ Questionário Finalizado!</h2>\n🎯 Excelente! Você acertou todas as questões!";
      } else if (score === 3) {
        mensagem = "<h2>✅ Questionário Finalizado!</h2>\n👏 Muito bem! Você acertou 3 de 4 questões.";
      } else if (score === 2) {
        mensagem = "<h2>✅ Questionário Finalizado!</h2>\n✨ Bom esforço! Você acertou 2 de 4.";
      } else {
        mensagem = `<h2>✅ Questionário Finalizado!</h2>\n📘 Continue praticando! Você acertou ${score} de 4.`;
      }

      ajustarAltura("600px", "700px");

      box.innerHTML = `
        <div class="final-message">
            <p>${mensagem}</p>
        </div>
      `;

      // Cria o botão separadamente
      const botaoVoltar = document.createElement("a");
      botaoVoltar.href = "questoes-matematica.html";
      botaoVoltar.textContent = "Voltar para Matemática";
      botaoVoltar.className = "return-button";

      const container = document.querySelector('.container');

      const botaoWrapper = document.createElement("div");
      botaoWrapper.style.display = "flex";
      botaoWrapper.style.justifyContent = "center";
      botaoWrapper.style.marginTop = "auto";
      botaoWrapper.style.paddingBottom = "20px"; // espaço do fundo
      botaoWrapper.appendChild(botaoVoltar);

      container.appendChild(botaoWrapper);

      feedback.innerHTML = '';
    }
  }



  // Inicializa: Verifica login e renderiza primeira questão
  if (verificarLogin()) {
    renderQuestion(); // inicializa a primeira questão
  }
</script>

</body>
</html>
